function checkVip(){return _cu.isVip()?!0:($("#cVipTip").show(),!1)}function showCurrentSection(e){if(e.length>0&&e[0].url){var t=pageUtil.getMainHostName(e[0].url);$("#currentDomainManage").show();if(!t){var n="<br/><br/>"+chrome.i18n.getMessage("current_domain_needless");$("#currentDomainManage").html(n),$("#currentDomainManage").height(103);return}$("#currnetDomianName").html(t),_cu.isUrlProxyed(e[0].url)?($("#currentDomainSectionTitle").html(chrome.i18n.getMessage("current_domain_already_in")),$("#btnAddCurrentDomain").parent().hide(),$("#btnRemoveCurrentDomain").click(function(){if(!t)return;if(!checkVip())return;var e=[];e.push(t),userManager.removeDomain(e),window.close()})):($("#currentDomainSectionTitle").html(chrome.i18n.getMessage("current_domain_no_in")),$("#btnRemoveCurrentDomain").parent().hide(),$("#btnAddCurrentDomain").click(function(){if(!t)return;if(!checkVip())return;var e=[];e.push(t),userManager.addDomain(e),window.close()}))}}function showBlockSection(e,t){$("#blockDomainManage").show(),$.each(e,function(e,t){if(!t)return;var n=chrome.i18n.getMessage("excludeDomainTip"),r=t;t.length>33&&(r=t.substr(0,30)+"...");var i='<li data="'+t+'"><span>'+r+'</span><label data-toggle="tooltipLeft" i18n_title="'+n+'" ><div class="removeButton"></div></label></li>';$(i).appendTo($("#domainUl"))}),$(".removeButton").click(function(e,n){if(!checkVip())return!1;var r=$(this).parent().parent(),i=r.attr("data");_cf.removeBlocked(t,i),r.remove();var s=$("#blockDomainManage").find("li").length;s==0}),$("#addBlockDomain").click(function(){if(!checkVip())return!1;var e=[];$("#domainUl li").each(function(t,n){e.push($(n).attr("data"))}),_cf.clearBlocked(),userManager.addDomain(e),window.close()})}function initDomainManage(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0].id,n=_cf.getBlocked(t);n.length>0?showBlockSection(n,t):showCurrentSection(e),rendered=!0})}var rendered=!1;$(function(){var e=_cu;$("#btn_buyVipPop").on("click",function(){paymentManager.startPay()}),$("#lStateOpen").on("click",function(){return checkVip()?!0:!1}),initDomainManage(),$("#btnOpenOptions").click(function(){pageUtil.openPage("options.html"),window.close(),_gaq.push(["_trackEvent","Ext","open options","on popup"])}),$('input[name="state"][value="'+e.state+'"]').attr("checked","checked"),$(":input:checked").parent(".btn").addClass("active"),$(document).on("change",'input:radio[id^="state"]',function(t){var n=t.currentTarget.id;n=="stateHalfOpen"&&(userManager.changeState(_cf.state_on),_gaq.push(["_trackEvent","Ext","switch-off","on popup"]));if(n=="stateOpen"){if(!checkVip()){$('input[name="state"][value="'+e.state+'"]').attr("checked","checked");return}userManager.changeState(_cf.state_always_on),_gaq.push(["_trackEvent","Ext","switch-always_on","on popup"])}n=="stateClose"&&(userManager.changeState(_cf.state_off),_gaq.push(["_trackEvent","Ext","switch-on","on popup"]))}),_gaq.push(["_trackEvent","Ext","open popup",""]);var t=!1;$(document).hover(function(e){if(t)return;t=!0,$('[data-toggle="tooltip"]').tooltip({placement:"top"}),$('[data-toggle="tooltipLeft"]').tooltip({placement:"left"})}),$("#aProductDiff").attr("href",_cf.url_product_diff);while(rendered)return});